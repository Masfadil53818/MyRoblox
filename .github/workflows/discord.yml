name: Discord Notify

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          # fail early with clear message when secret is not set
          if [ -z "$DISCORD_WEBHOOK" ]; then
            echo "ERROR: DISCORD_WEBHOOK secret is not set. Please add it in Settings -> Secrets -> Actions.";
            exit 1;
          fi

          # Send message to Discord
          curl -sS --fail -X POST \
            -H "Content-Type: application/json" \
            -d '{
              "username": "GitHub Actions",
              "content": "ðŸš€ Push baru ke **${{ github.repository }}**\nðŸ‘¤ Oleh: **${{ github.actor }}**\nðŸŒ¿ Branch: **${{ github.ref_name }}**"
            }' "$DISCORD_WEBHOOK"